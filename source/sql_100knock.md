---
date    : 2021-09-25
title   : ã€ğŸ” SQLã€‘ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹100æœ¬ãƒãƒƒã‚¯ï¼ˆæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿åŠ å·¥ç·¨ï¼‰
excerpt : ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹å”ä¼šãŒã€ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹åˆå­¦è€…ã®ãŸã‚ã®å®Ÿè·µçš„ãªå­¦ç¿’ç’°å¢ƒã‚’GitHubã«ç„¡æ–™å…¬é–‹ï¼
tags    : ["DataScientist", "GitHub", "Docker", "SQL"]
---
## SQLç·¨
### | S-001
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å…¨é …ç›®ã‚’10ä»¶æŠ½å‡ºã—ã€ã©ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã‚’ä¿æœ‰ã—ã¦ ã„ã‚‹ã‹ç›®è¦–ã§ç¢ºèªã›ã‚ˆã€‚
```SQL
select * from `100knocks.receipt` limit 10;
```

### | S-002
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ã®ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID (customer_id)ã€å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€ 10ä»¶è¡¨ç¤ºã•ã›ã‚ˆã€‚
```SQL
select
    sales_ymd
    , customer_id
    , product_cd
    , amount
from `100knocks.receipt`
limit 10
;
```

### |S-003
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ã®ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID (customer_id)ã€å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€10ä»¶è¡¨ç¤ºã•ã›ã‚ˆã€‚ãŸã ã—ã€sales_ymdã¯sales_dateã«é …ç›®åã‚’å¤‰æ›´ã—ãªãŒã‚‰æŠ½å‡ºã™ã‚‹ã“ ã¨ã€‚
```SQL
select
    sales_ymd as sales_date
    , customer_id
    , product_cd
    , amount
from `100knocks.receipt`
limit 10
;
```

### | S-004
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ã®ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID (customer_id)ã€å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€ ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚
+ é¡§å®¢IDï¼ˆcustomer_idï¼‰ãŒ"CS018205000001"

```SQL
select
    sales_ymd
    , customer_id
    , product_cd
    , amount
from `100knocks.receipt`
where customer_id = 'CS018205000001'
;
```

### | S-005
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ã®ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID (customer_id)ã€å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€ ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚
+ é¡§å®¢IDï¼ˆcustomer_idï¼‰ãŒ"CS018205000001"
+ å£²ä¸Šé‡‘é¡ï¼ˆamountï¼‰ãŒ1,000ä»¥ä¸Š

```sql
select
    sales_ymd
    , customer_id
    , product_cd
    , amount
from `100knocks.receipt`
where
    customer_id = 'CS018205000001'
    and
    amount >= 1000
;
```

### | S-006
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID(customer_id)ã€ å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šæ•°é‡(quantity)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®š ã—ã€ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚
+ é¡§å®¢IDï¼ˆcustomer_idï¼‰ãŒ"CS018205000001"
+ å£²ä¸Šé‡‘é¡ï¼ˆamountï¼‰ãŒ1,000ä»¥ä¸Šã¾ãŸã¯å£²ä¸Šæ•°é‡ï¼ˆquantityï¼‰ãŒ5ä»¥ä¸Š

```sql
select
    sales_ymd
    , customer_id
    , product_cd
    , quantity
    , amount
from `100knocks.receipt`
where
    customer_id = 'CS018205000001'
    and
    (amount >= 1000 or quantity >= 5)
;
```

### | S-007
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ã®ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID (customer_id)ã€å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€ ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚
+ é¡§å®¢IDï¼ˆcustomer_idï¼‰ãŒ"CS018205000001"
+ å£²ä¸Šé‡‘é¡ï¼ˆamountï¼‰ãŒ1,000ä»¥ä¸Š2,000ä»¥ä¸‹

```sql
select
    sales_ymd
    , customer_id
    , product_cd
    , amount
from `100knocks.receipt`
where
    customer_id = 'CS018205000001'
    and
    amount between 1000 and 2000
;
```

### | S-008
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID(customer_id)ã€ å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸ ã™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚
+ é¡§å®¢IDï¼ˆcustomer_idï¼‰ãŒ"CS018205000001"
+ å•†å“ã‚³ãƒ¼ãƒ‰ï¼ˆproduct_cdï¼‰ãŒ"P071401019"ä»¥å¤–

```SQL
select
    sales_ymd
    , customer_id
    , product_cd
    , amount
from `100knocks.receipt`
where
    customer_id = 'CS018205000001'
    and
    product_cd <> 'P071401019'
;
```

### | S-009
ä»¥ä¸‹ã®å‡¦ç†ã«ãŠã„ã¦ã€å‡ºåŠ›çµæœã‚’å¤‰ãˆãšã«ORã‚’ANDã«æ›¸ãæ›ãˆã‚ˆã€‚

`select * from store where not (prefecture_cd = '13' or floor_area > 900)`

```sql
select
    *
from `100knocks.store`
where
    prefecture_cd <> 13
    and
    floor_area < 900
;
```

### | S-010
åº—èˆ—ãƒ†ãƒ¼ãƒ–ãƒ«(store)ã‹ã‚‰ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ãŒ"S14"ã§å§‹ã¾ã‚‹ã‚‚ã®ã ã‘å…¨é …ç›®æŠ½ å‡ºã—ã€10ä»¶ã ã‘è¡¨ç¤ºã›ã‚ˆã€‚

```SQL
select
    *
from `100knocks.store`
where store_cd like 'S14%'
-- where regexp_contains(store_cd, r'S14') #åˆ¥è§£
limit 10
;
```

### | S-011
é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‹ã‚‰é¡§å®¢ID(customer_id)ã®æœ«å°¾ãŒ1ã®ã‚‚ã®ã ã‘å…¨é …ç›®æŠ½å‡º ã—ã€10ä»¶ã ã‘è¡¨ç¤ºã›ã‚ˆã€‚

```SQL
select
    *
from `100knocks.customer`
where regexp_contains(customer_id, r'1$')
limit 10
;
```

### | S-012
åº—èˆ—ãƒ†ãƒ¼ãƒ–ãƒ«(store)ã‹ã‚‰æ¨ªæµœå¸‚ã®åº—èˆ—ã ã‘å…¨é …ç›®è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
select
    *
from `100knocks.store`
where address like '%æ¨ªæµœå¸‚%'
;
```

### | S-013
é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‹ã‚‰ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰(status_cd)ã®å…ˆé ­ãŒã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒ ãƒˆã®Aã€œFã§å§‹ã¾ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å…¨é …ç›®æŠ½å‡ºã—ã€10ä»¶ã ã‘è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
select
    *
from `100knocks.customer`
where
    regexp_contains(customer_id, r'^(A|B|C|D|E|F)')
    -- customer_id like 'A%'
    -- or
    -- customer_id like 'B%'
    -- or
    -- customer_id like 'C%'
    -- or
    -- customer_id like 'D%'
    -- or
    -- customer_id like 'E%'
    -- or
    -- customer_id like 'F%'
limit 10
;
```
Cf. [BigQueryã§LIKEæ–‡ã®è¤‡æ•°æ¡ä»¶æŒ‡å®šã‚’ORã‹ã‚‰æ­£è¦è¡¨ç¾ã«ç›´ã™](https://qiita.com/mida12251141/items/27fe42ef01e83d5b063f) - Qiita

### | S-014
é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‹ã‚‰ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰(status_cd)ã®æœ«å°¾ãŒæ•°å­—ã®1ã€œ9ã§ çµ‚ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å…¨é …ç›®æŠ½å‡ºã—ã€10ä»¶ã ã‘è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
select
    *
from `prj-test3.100knocks.customer`
where
    regexp_contains(status_cd, r'[1-9]$')
limit 10
;
```

### | S-015
é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‹ã‚‰ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰(status_cd)ã®å…ˆé ­ãŒã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®Aã€œFã§å§‹ã¾ã‚Šã€æœ«å°¾ãŒæ•°å­—ã®1ã€œ9ã§çµ‚ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å…¨é …ç›®æŠ½å‡ºã—ã€10ä»¶ã ã‘è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
select
    *
from `prj-test3.100knocks.customer`
where
    regexp_contains(status_cd, r'^(A|B|C|D|E|F)-\d+-[1-9]$')
limit 10
;
```
Cf. [åŸºæœ¬çš„ãªæ­£è¦è¡¨ç¾ä¸€è¦§](https://murashun.jp/article/programming/regular-expression.html) - murashun.jp

### | S-016
åº—èˆ—ãƒ†ãƒ¼ãƒ–ãƒ«(store)ã‹ã‚‰ã€é›»è©±ç•ªå·(tel_no)ãŒ3æ¡-3æ¡-4æ¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¨é …ç›®è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
select
    *
from `prj-test3.100knocks.store`
where regexp_contains(tel_no, r'\d{3}-\d{3}-\d{4}')
;
```

### | S-017
é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‚’ç”Ÿå¹´æœˆæ—¥(birth_day)ã§é«˜é½¢é †ã«ã‚½ãƒ¼ãƒˆã—ã€å…ˆé ­10ä»¶ã‚’å…¨é …ç›®è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
```

### | S-018
é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‚’ç”Ÿå¹´æœˆæ—¥(birth_day)ã§è‹¥ã„é †ã«ã‚½ãƒ¼ãƒˆã—ã€å…ˆé ­10ä»¶ã‚’å…¨ é …ç›®è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
```

### | S-019
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€1ä»¶ã‚ãŸã‚Šã®å£²ä¸Šé‡‘é¡(amount)ãŒé«˜ã„é †ã«ãƒ© ãƒ³ã‚¯ã‚’ä»˜ä¸ã—ã€å…ˆé ­10ä»¶ã‚’æŠ½å‡ºã›ã‚ˆã€‚é …ç›®ã¯é¡§å®¢ID(customer_id)ã€å£²ä¸Šé‡‘é¡ (amount)ã€ä»˜ä¸ã—ãŸãƒ©ãƒ³ã‚¯ã‚’è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ã€‚ãªãŠã€å£²ä¸Šé‡‘é¡(amount)ãŒç­‰ã—ã„å ´åˆã¯åŒä¸€é †ä½ã‚’ä»˜ä¸ã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚
```SQL
```

### | S-020
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€1ä»¶ã‚ãŸã‚Šã®å£²ä¸Šé‡‘é¡(amount)ãŒé«˜ã„é †ã«ãƒ© ãƒ³ã‚¯ã‚’ä»˜ä¸ã—ã€å…ˆé ­10ä»¶ã‚’æŠ½å‡ºã›ã‚ˆã€‚é …ç›®ã¯é¡§å®¢ID(customer_id)ã€å£²ä¸Šé‡‘é¡ (amount)ã€ä»˜ä¸ã—ãŸãƒ©ãƒ³ã‚¯ã‚’è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ã€‚ãªãŠã€å£²ä¸Šé‡‘é¡(amount)ãŒç­‰ã—ã„å ´ åˆã§ã‚‚åˆ¥é †ä½ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã€‚
```SQL
```

### | S-021
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€ä»¶æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã›ã‚ˆã€‚
```SQL
```

### | S-022
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®é¡§å®¢ID(customer_id)ã«å¯¾ã—ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ä»¶æ•°ã‚’ã‚«ã‚¦ ãƒ³ãƒˆã›ã‚ˆã€‚
```SQL
```

### | S-023
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã¨å£²ä¸Šæ•°é‡(quantity)ã‚’åˆè¨ˆã›ã‚ˆã€‚
```SQL
```

### | S-024
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€é¡§å®¢ID(customer_id)ã”ã¨ã«æœ€ã‚‚æ–°ã—ã„å£²ä¸Š æ—¥(sales_ymd)ã‚’æ±‚ã‚ã€10ä»¶è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
```

### | S-025
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€é¡§å®¢ID(customer_id)ã”ã¨ã«æœ€ã‚‚å¤ã„å£²ä¸Šæ—¥ (sales_ymd)ã‚’æ±‚ã‚ã€10ä»¶è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
```

### | S-026
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€é¡§å®¢ID(customer_id)ã”ã¨ã«æœ€ã‚‚æ–°ã—ã„å£²ä¸Š æ—¥(sales_ymd)ã¨å¤ã„å£²ä¸Šæ—¥ã‚’æ±‚ã‚ã€ä¸¡è€…ãŒç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’10ä»¶è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
```

### | S-027
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã®å¹³å‡ã‚’è¨ˆç®—ã—ã€é™é †ã§TOP5ã‚’è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
```

### | S-028
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã®ä¸­å¤®å€¤ã‚’è¨ˆç®—ã—ã€é™é †ã§TOP5ã‚’è¡¨ç¤ºã›ã‚ˆã€‚
```SQL
```

### | S-029
ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å•†å“ã‚³ãƒ¼ãƒ‰ (product_cd)ã®æœ€é »å€¤ã‚’æ±‚ã‚ã‚ˆã€‚
```SQL
```

### | S-030
```SQL
```

### | S-031
```SQL
```

### | S-032
```SQL
```

### | S-033
```SQL
```

### | S-034
```SQL
```

### | S-035
```SQL
```

### | S-036
```SQL
```

### | S-037
```SQL
```

### | S-038
```SQL
```

### | S-039
```SQL
```

### | S-040
```SQL
```

### | S-041
```SQL
```

### | S-042
```SQL
```

### | S-043
```SQL
```

### | S-044
```SQL
```

### | S-045
```SQL
```

### | S-045
```SQL
```

### | S-046
```SQL
```

### | S-047
```SQL
```

### | S-048
```SQL
```

### | S-049
```SQL
```

### | S-050
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```

### | S-0
```SQL
```
